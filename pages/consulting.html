<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brand Consulting - PopKornMachine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="/styles.css" rel="stylesheet">
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <header class="mb-8">
            <a href="/" class="text-blue-600 hover:text-blue-800 mb-4 inline-block">&larr; Back to Home</a>
            <h1 class="text-3xl font-bold text-gray-900">Brand Consulting Services</h1>
            <p class="text-gray-600 mt-2">Analyze websites and generate comprehensive brand voice recommendations</p>
        </header>

        <form id="consultingForm" class="bg-white rounded-lg shadow-lg p-6">
            <!-- Website URLs -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Website Analysis</h2>
                <div id="urlsContainer">
                    <div class="flex gap-2 mb-2">
                        <input type="url" class="websiteUrl flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="https://example.com" required>
                        <button type="button" onclick="addUrl()" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">+</button>
                    </div>
                </div>
                <p class="text-sm text-gray-500 mt-2">Enter primary website URLs to analyze (up to 5)</p>
            </div>

            <!-- Analysis Focus -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Analysis Focus</h2>
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Business Focus Area</label>
                        <input type="text" id="focus" placeholder="e.g., Technology, Healthcare, E-commerce" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Analysis Depth</label>
                        <select id="depth" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" required>
                            <option value="">Select depth</option>
                            <option value="basic">Basic Analysis</option>
                            <option value="comprehensive">Comprehensive Analysis</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="flex justify-end">
                <button type="submit" id="submitBtn" class="px-8 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    Start Analysis
                </button>
            </div>
        </form>

        <!-- Results Section -->
        <div id="results" class="mt-8 hidden">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Analysis Results</h2>
            <div id="resultsContent" class="bg-white rounded-lg shadow-lg p-6">
                <!-- Results will be populated here -->
            </div>
        </div>

        <!-- Loading Section -->
        <div id="loading" class="mt-8 hidden">
            <div class="bg-white rounded-lg shadow-lg p-6 text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto mb-4"></div>
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Analyzing Websites...</h3>
                <p class="text-gray-600">This may take 30-60 seconds as we process your websites with AI</p>
            </div>
        </div>
    </div>

    <script>
        let urlCount = 1;

        function addUrl() {
            if (urlCount >= 5) {
                alert('Maximum 5 URLs allowed');
                return;
            }

            urlCount++;
            const container = document.getElementById('urlsContainer');
            const div = document.createElement('div');
            div.className = 'flex gap-2 mb-2';
            div.innerHTML = `
                <input type="url" class="websiteUrl flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="https://example.com">
                <button type="button" onclick="removeUrl(this)" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">-</button>
            `;
            container.appendChild(div);
        }

        function removeUrl(btn) {
            btn.parentElement.remove();
            urlCount--;
        }

        document.getElementById('consultingForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const submitBtn = document.getElementById('submitBtn');
            const loadingDiv = document.getElementById('loading');
            const resultsDiv = document.getElementById('results');

            submitBtn.disabled = true;
            submitBtn.textContent = 'Analyzing...';
            loadingDiv.classList.remove('hidden');
            resultsDiv.classList.add('hidden');

            try {
                const formData = {
                    urls: Array.from(document.querySelectorAll('.websiteUrl')).map(input => input.value).filter(url => url.trim()),
                    focus: document.getElementById('focus').value,
                    depth: document.getElementById('depth').value
                };

                const response = await fetch('/api/consulting/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (response.ok) {
                    displayResults(result);
                } else {
                    throw new Error(result.error || 'Failed to analyze websites');
                }

            } catch (error) {
                alert('Error: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Start Analysis';
                loadingDiv.classList.add('hidden');
            }
        });

        function displayResults(result) {
            const resultsDiv = document.getElementById('results');
            const contentDiv = document.getElementById('resultsContent');

            contentDiv.innerHTML = `
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-2">Analysis Overview</h3>
                    <p class="text-gray-700">${result.analysis?.overview || 'Analysis completed'}</p>
                </div>

                ${result.analysis?.swot ? `
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-4">SWOT Analysis</h3>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-medium text-green-600 mb-2">Strengths</h4>
                            <ul class="list-disc list-inside text-gray-700 space-y-1">
                                ${result.analysis.swot.strengths?.map(item => `<li>${item}</li>`).join('') || '<li>No strengths identified</li>'}
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-medium text-blue-600 mb-2">Weaknesses</h4>
                            <ul class="list-disc list-inside text-gray-700 space-y-1">
                                ${result.analysis.swot.weaknesses?.map(item => `<li>${item}</li>`).join('') || '<li>No weaknesses identified</li>'}
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-medium text-purple-600 mb-2">Opportunities</h4>
                            <ul class="list-disc list-inside text-gray-700 space-y-1">
                                ${result.analysis.swot.opportunities?.map(item => `<li>${item}</li>`).join('') || '<li>No opportunities identified</li>'}
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-medium text-red-600 mb-2">Threats</h4>
                            <ul class="list-disc list-inside text-gray-700 space-y-1">
                                ${result.analysis.swot.threats?.map(item => `<li>${item}</li>`).join('') || '<li>No threats identified</li>'}
                            </ul>
                        </div>
                    </div>
                </div>
                ` : ''}

                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-2">Recommendations</h3>
                    <ul class="list-disc list-inside text-gray-700 space-y-1">
                        ${result.analysis?.recommendations?.map(rec => `<li>${rec}</li>`).join('') || '<li>No recommendations available</li>'}
                    </ul>
                </div>

                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-2">Brand Voice Analysis</h3>
                    <p class="text-gray-700">${result.brandVoice || 'Brand voice analysis not available'}</p>
                </div>

                <div class="flex gap-4">
                    <button onclick="downloadReport('${result.id}')" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        Download Full Report
                    </button>
                    <button onclick="emailReport('${result.id}')" class="px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                        Email Report
                    </button>
                </div>
            `;

            resultsDiv.classList.remove('hidden');
        }

        function downloadReport(analysisId) {
            // Implement download functionality
            alert('Download functionality coming soon!');
        }

        function emailReport(analysisId) {
            // Implement email functionality
            alert('Email functionality coming soon!');
        }
    </script>
</body>
</html>
